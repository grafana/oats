[tools]
go = "1.26.0"
golangci-lint = "2.10.1"
lychee = "0.22.0"
node = "24.13.1"
"npm:renovate" = "43.11.1"

[env]
RENOVATE_TRACKED_DEPS_EXCLUDE="github-actions,github-runners"
# renovate: datasource=docker depName=ghcr.io/super-linter/super-linter
SUPER_LINTER_VERSION="v8.4.0@sha256:c5e3307932203ff9e1e8acfe7e92e894add6266605b5d7fb525fb371a59a26f4"

# Shared lint tasks from flint (https://github.com/grafana/flint)
[tasks."lint:super-linter"]
description = "Run Super-Linter on the repository"
file = "https://raw.githubusercontent.com/grafana/flint/5bb3726cfe3305072457c0c4fa85dce5ca154680/tasks/lint/super-linter.sh" # v0.6.0
[tasks."lint:links"]
description = "Check for broken links in changed files + all local links"
file = "https://raw.githubusercontent.com/grafana/flint/5bb3726cfe3305072457c0c4fa85dce5ca154680/tasks/lint/links.sh" # v0.6.0
[tasks."lint:renovate-deps"]
description = "Verify renovate-tracked-deps.json is up to date"
file = "https://raw.githubusercontent.com/grafana/flint/5bb3726cfe3305072457c0c4fa85dce5ca154680/tasks/lint/renovate-deps.py" # v0.6.0

[tasks.test]
description = "Run tests"
run = "go test $(go list ./...)"

[tasks.integration-test]
description = "Run integration tests"
env.INTEGRATION_TESTS = "true"
run = "go test github.com/grafana/oats/tests"

[tasks.fmt]
description = "Format code"
run = "gofmt -w ."

[tasks.check-fmt]
description = "Check code formatting"
run = "gofmt -l . | grep . && exit 1 || exit 0"

[tasks."lint:go"]
description = "Lint Go code"
run = "golangci-lint run"

[tasks."lint"]
description = "Run all lints"
depends = ["lint:super-linter", "lint:links", "lint:renovate-deps", "lint:go"]

[tasks.fix]
description = "Auto-fix lint issues and regenerate tracked deps"
run = "AUTOFIX=true mise run lint"

[tasks.deps]
description = "Update dependencies"
run = "go mod tidy"

[tasks.check]
description = "Run all checks"
depends = ['lint:go', 'test', 'check-fmt']

[tasks.build]
description = "Build the project"
run = "go build"
